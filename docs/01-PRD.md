# 던전 경영 로그라이크 PRD

| 날짜       | 버전 | 설명                                    | 작성자    |
| :--------- | :--- | :-------------------------------------- | :-------- |
| 2025-08-05 | 1.0  | 초기 PRD 초안 작성                      | John (PM) |
| 2025-08-09 | 2.0  | BMad Method PM과 협업하여 MVP 버전 완성 | John (PM) |

## 1. 목표 및 배경 컨텍스트

### 목표

- **사용자 목표:** 플레이어는 몬스터 제작, 동료 모집 등 전략적인 선택을 통해 자신의 던전을 방어하는 재미를 경험한다.
- **사용자 목표:** 로그라이크 요소를 통해 패배하더라도 일부 요소를 계승하여, 높은 리플레이 가치를 느끼게 한다.
- **사용자 목표:** 독특한 '신체 특징 조합' 시스템과 지속적인 이벤트 업데이트를 통해 매번 새롭고 흥미로운 플레이를 즐긴다.
- **프로젝트 목표:** 웹 기반 텍스트 게임으로 가볍고 빠른 접근성을 제공하여 플레이어의 진입 장벽을 낮춘다.
- **프로젝트 목표:** '던전 위험도 100% 도달 시 최종 전투'라는 명확한 승리 조건을 통해 플레이어에게 뚜렷한 도전 과제와 성취감을 제공한다.

### 배경 컨텍스트

본 프로젝트는 플레이어가 던전의 경영자인 '네크로맨서'가 되어 스토리를 진행하는 텍스트 기반의 로그라이크 경영 시뮬레이션 게임입니다. 플레이어는 언데드 몬스터를 창조하거나 '신체 특징 조합' 시스템을 통해 생성되는 개성 있는 동료들을 모집하여 외부의 위협으로부터 던전을 방어해야 합니다.

게임의 하루는 아침/점심/저녁으로 나뉘며, 시간이 지남에 따라 '던전 위험도'가 증가합니다. 플레이어는 특정 시간에 발생하는 이벤트, D-day가 걸린 이벤트 등 다양한 무작위 이벤트를 수행하며 던전 위험도를 관리하게 됩니다. 최종적으로 던전 위험도가 100%에 도달했을 때 발생하는 마지막 전투에서 승리하는 것이 게임의 핵심 목표입니다.

## 2. 요구사항

### 기능 요구사항 (Functional Requirements) - MVP

- `FR1`: 플레이어는 '영혼'과 같은 자원을 소모하여 '언데드 몬스터'를 창조(Creation)하고 던전의 방어 슬롯에 배치할 수 있다.
- `FR2`: 플레이어는 '신체 특징 조합' 시스템을 통해 무작위로 생성된 동료를 모집할 수 있다.
- `FR3`: 게임 내에는 시간이 흐르며(아침/점심/저녁), 시간에 따라 특정 이벤트가 발생한다.
- `FR4`: '던전 위험도' 수치가 존재하며, 시간 경과나 이벤트 결과에 따라 변동된다.
- `FR5`: 플레이어가 최종 전투에서 패배할 경우, 특정 재화나 잠금 해제된 동료/몬스터 정보를 계승하여 새로운 게임을 시작할 수 있다.
- `FR6`: 플레이어는 매 턴(아침/점심/저녁)마다 '탐험', '이벤트', '제작', '휴식', '던전 증축' 등과 같은 행동을 선택하여 수행할 수 있다.
- `FR7`: 하루가 지날 때마다, 현재 '던전 위험도'에 따라 확률적으로 '침략 이벤트'가 발생할 수 있다.
- `FR8`: '침략 이벤트'에서 승리하면 보상(예: 포로, 아이템)을 획득하고, 패배하면 던전의 자원 일부를 잃는다.
- `FR9`: '침략 이벤트'를 통해 획득한 포로 캐릭터는 자원을 소모하거나 설득/대화 상호작용을 통해 동료로 영입할 수 있다.
- `FR12`: 플레이어는 '던전 증축' 행동을 수행하거나 특정 이벤트의 보상으로 동료를 배치할 수 있는 최대 코스트(또는 슬롯 수)를 확장할 수 있다.
- `FR13`: 특정 이벤트를 완료하면, 멀티 엔딩 분기에 영향을 주는 '엔딩 플래그'가 활성화/비활성화될 수 있다.
- `FR14`: 이벤트 내 선택지는 정해진 확률에 따라 다른 결과로 이어질 수 있다.
- `FR15`: 플레이어는 이벤트를 통해서도 새로운 동료를 획득할 수 있다.
- `FR16`: 동료는 '스킬 카드'와 같은 아이템을 사용하여 새로운 스킬을 습득하거나 강화할 수 있으며, 스킬 카드는 '탐험'을 통해 획득하거나 포로를 제물로 바쳐 얻을 수 있다.
- `FR17`: '탐험'을 통해 '영혼', '뼈 조각' 등 네크로맨서 테마에 맞는 자원을 획득할 수 있다.

### 비기능적 요구사항 (Non-Functional Requirements)

- `NFR1`: 게임 내 이벤트는 외부 JSON 파일 형식으로 정의되며, 게임 클라이언트는 이 파일들을 비동기적으로 로드하여 이벤트를 실행한다.
- `NFR2`: 게임은 PC 웹 브라우저(Chrome, Edge, Safari 최신 버전)에서 별도의 설치 없이 구동되어야 한다.
- `NFR3`: 플레이어의 게임 진행 상황은 하루(3턴)가 종료되는 시점마다 서버에 자동으로 저장되어야 한다.

## 3. 사용자 인터페이스(UI) 및 사용자 경험(UX) 목표

### 전체 UX 비전

미니멀하고 텍스트에 집중된 인터페이스를 통해 플레이어가 직관적이고 빠르게 전략적 결정을 내릴 수 있도록 한다. 불필요한 시각적 요소를 최소화하고 가독성을 극대화하여, 마치 한 편의 인터랙티브 소설을 읽는 듯한 경험을 제공하는 것을 목표로 한다.

### 핵심 인터랙션 패러다임

- **선택지 기반 진행:** 모든 상호작용은 클릭 가능한 텍스트 선택지와 버튼을 통해 이루어진다.
- **상태 정보의 지속적 표시:** 자원, 던전 위험도, 현재 시간 등 핵심 정보는 화면의 특정 위치에 항상 표시되어 플레이어가 언제든 확인할 수 있다.
- **로그(Log) 형식의 이벤트 표시:** 이벤트, 대화, 전투 결과 등은 중앙의 스크롤 가능한 영역에 순차적으로 기록되어 지난 내용을 쉽게 파악할 수 있다.
- **단일 페이지 경험:** 화면 전환은 URL 변경 없이 라이브러리를 통해 관리되어, 끊김 없는 단일 페이지 애플리케이션(SPA) 경험을 제공한다.

## 4. 기술적 가정(요약)

- Next.js 15(App Router, Server Components/Server Actions 중심), TypeScript
- Supabase(PostgreSQL/RLS/Storage), 이벤트 JSON 외부 로드(NFR1)
- 서버 상태: TanStack Query, 클라이언트 UI 상태 최소화(Zustand), 폼/검증: RHF + Zod
- 캐시/보안: `revalidateTag` 표준, `serverActions.allowedOrigins` 엄격 관리, SSR 세션 처리(@supabase/ssr)
- 대상 브라우저: 최신 Chrome/Edge/Safari

자세한 내용은 다음 문서를 참고하세요:

- 아키텍처 개요: `docs/02-Architecture.md`
- 게임 루프 기술 사양: `docs/03-Tech-Spec-GameLoop.md`
- 데이터 모델: `docs/04-Data-Model.md`
- API 규격(Server Actions): `docs/05-API-Contracts.md`
- 이벤트 JSON 스키마: `docs/06-Events-Schema.md`
- 테스트 전략: `docs/07-Testing-Strategy.md`
- 운영/배포: `docs/08-Operations.md`
- ADR: `docs/adr/0001-use-server-actions.md`

## 5. 에픽 리스트

- **에픽 1: 프로젝트 기반 및 핵심 플레이 루프 구축**
- **에픽 2: 동료 및 이벤트 시스템 구현**
- **에픽 3: 성장 및 리플레이 가치 강화**

---

## **에픽 1: 프로젝트 기반 및 핵심 플레이 루프 구축**

**에픽 목표:** 플레이어가 시간의 흐름을 경험하고, 던전의 상태를 확인하며, 기본적인 자원 관리와 방어 준비를 시작할 수 있는 최초의 플레이 가능 버전을 구현합니다.

### **스토리 1.1 ~ 1.3 (기존 PRD 내용과 동일)**

### **스토리 1.4: 자원을 소모하여 몬스터 제작**

**As a** 네크로맨서,
**I want** 자원을 소모하여 몬스터를 만들기를,
**so that** 던전 방어의 기반을 마련할 수 있다.

**인수 조건(Acceptance Criteria):**

1.  메인 대시보드에 '제작' 행동 버튼이 있으며, 이를 클릭하면 제작 UI로 이동한다.
2.  제작 UI에는 제작 가능한 몬스터 목록이 표시되며, 각 몬스터의 이름, 필요 자원(비용), 기본 능력치가 포함된다.
3.  플레이어의 현재 보유 자원이 몬스터 제작 비용보다 부족할 경우, 해당 몬스터의 제작 버튼은 비활성화된다.
4.  제작 버튼을 클릭하면, 플레이어의 자원이 비용만큼 즉시 차감된다.
5.  제작이 완료된 몬스터는 '보유 몬스터' 목록에 추가되며, 플레이어는 이 목록을 메인 대시보드에서 확인할 수 있다.

---

### 부록 A. 게임 퍼널 뷰 전환 스켈레톤(use-funnel)

- 목적: 라우팅 전환 없이 단계형 흐름(예: 인트로 → 선택 → 결과)을 내부 상태로 관리
- 구성: `useFunnel` 훅으로 step/context/history를 관리하고, `<funnel.Render />`로 단계별 UI 렌더링
- 예시(개념 코드)

참고: use-funnel 문서 [use-funnel](https://use-funnel.slash.page/ko/docs/use-funnel)

## **에픽 2: 동료 및 이벤트 시스템 구현**

**에픽 목표:** '신체 특징 조합'을 통한 동료 모집 시스템과 '침략 이벤트' 등 게임의 핵심적인 상호작용 시스템을 도입하여 플레이어의 성장과 위기 경험을 구체화합니다.

### **스토리 2.1: 신체 특징 조합을 통한 동료 모집**

**As a** 네크로맨서,
**I want** '신체 특징 조합' 시스템을 통해 무작위로 생성된 동료를 모집하기를,
**so that** 던전을 함께 방어하고 성장시킬 개성 있는 인재를 확보할 수 있다.

**인수 조건(Acceptance Criteria):**

1.  메인 대시보드에 '모집' 행동 버튼이 있으며, 이를 클릭하면 동료 모집 UI로 이동한다. (`FR6`)
2.  모집 UI에는 플레이어가 조합할 수 있는 여러 개의 '신체 특징' 카드(예: 날카로운 눈, 강철같은 심장, 빠른 손재주)가 무작위로 제시된다.
3.  플레이어는 일정량의 자원을 소모하여 제시된 신체 특징 카드 중 2~3개를 선택하여 조합할 수 있다. (`FR2`)
4.  조합을 완료하면, 선택된 특징에 따라 능력치와 스킬이 결정된 새로운 동료 캐릭터가 생성된다.
5.  생성된 동료는 '보유 동료' 목록에 추가되며, 플레이어는 이들을 던전의 방어 슬롯에 배치할 수 있다. (`FR1`)

### **스토리 2.2: 침략 이벤트 발생 및 전투**

**As a** 던전의 위험도가 높아진 네크로맨서,
**I want** 내 던전에 모험가들이 쳐들어오기를,
**so that** 내 방어력을 시험하고, 위기감과 함께 이들을 격퇴하는 재미를 느낄 수 있다.

**인수 조건(Acceptance Criteria):**

1.  하루가 지날 때마다(3턴 경과 시), 현재 '던전 위험도' 수치에 따라 확률적으로 '침략 이벤트'가 발생한다. (`FR7`)
2.  이벤트가 발생하면, 플레이어에게 침략해 온 모험가 파티의 규모와 종류가 텍스트로 표시된다.
3.  전투는 자동 턴제로 진행된다. 매 턴마다 던전의 방어 유닛(몬스터/동료)과 모험가 파티는 서로의 총 공격력/방어력을 기반으로 피해를 입혀 '내구도'를 감소시킨다.
4.  던전 방어 유닛이 여러 파티로 나뉘어 배치된 경우, 앞 순서의 파티가 전멸하면 다음 순서의 파티가 이어서 전투를 계속한다.
5.  모든 모험가 파티를 격퇴하여 전투에서 승리하면, 침략 파티의 난이도에 비례하는 보상(예: 포로, 고급 아이템)을 획득하고 '승리' 메시지가 표시된다. (`FR8`)
6.  던전의 모든 방어 유닛이 전멸하여 전투에서 패배하면, 던전의 자원 일부를 잃고 '패배' 메시지가 표시된다. (`FR8`)
7.  전투에 참여한 동료/몬스터는 전투 결과에 따라 피로도/내구도가 감소한다. 전체 전투에서 승리했더라도, **전투 중 전멸한 파티에 속한 유닛들은 패배한 것으로 간주하여 피로도/내구도가 대폭 감소한다.** 그 외 승리한 전투에 참여한 유닛들은 소폭 감소한다.
8.  동료/몬스터의 피로도/내구도가 특정 기준치(예: 75%, 50%, 25%) 이하로 떨어지면 능력치에 디버프가 적용된다. 수치가 0이 되면 해당 유닛은 '부상/파손' 상태가 되어 일시적으로 사용할 수 없다.
9.  이벤트가 종료되면, 다음 날 아침으로 시간이 진행된다.
10. 플레이어는 전투 전, 각 방어 파티 내의 동료/몬스터를 '전위'와 '후위'에 배치할 수 있다.
11. 플레이어는 각 동료/몬스터에게 '자동 퇴각 HP 임계값'(%)을 설정할 수 있다. 전투 중 해당 유닛의 HP가 설정된 값 이하로 떨어지면, 그 유닛은 전투에서 자동으로 이탈하여 생존한다.
12. 퇴각한 유닛은 해당 전투에서 더 이상 싸울 수 없지만, 전투 후 받게 되는 피로도/내구도 감소 페널티가 대폭 줄어든다.

### **스토리 2.3: 포로 영입 및 관리**

**As a** 네크로맨서,
**I want** 포로를 설득하거나 세뇌하여 내 동료로 만들기를,
**so that** 적이었던 자들을 활용하여 내 던전의 전력을 강화할 수 있다.

**인수 조건(Acceptance Criteria):**

1.  침략 이벤트 승리 시, 일정 확률로 패배한 모험가들이 '포로'가 되어 '포로 슬롯'에 추가된다.
2.  플레이어는 '포로 관리' UI에서 현재 보유한 포로 목록과 그들의 상태(능력치, 저항 의지 등)를 확인할 수 있다.
3.  플레이어는 각 포로에게 '대화', '설득', '세뇌' 등과 같은 상호작용 행동을 턴을 소모하여 선택할 수 있다.
4.  각 상호작용은 성공 확률을 가지며, 성공 시 포로의 '저항 의지'를 감소시킨다.
5.  포로의 '저항 의지'가 0이 되면, 해당 포로는 '동료'로 영입되어 '보유 동료' 목록으로 이동한다. (`FR9`)
6.  영입 과정에서 특정 자원을 소모하거나, 특정 아이템(예: 세뇌의 아티팩트)을 사용하여 성공 확률을 높일 수 있다.

### **스토리 2.4: 던전 방어 계획 확장**

**As a** 전략가 네크로맨서,
**I want** 던전을 증축하여 방어에 투입할 '파티의 수'를 늘리기를,
**so that** 침략의 규모와 종류에 맞춰 다양한 조합의 방어 전략을 구사할 수 있다.

**인수 조건(Acceptance Criteria):**

1.  메인 대시보드에 '던전 증축' 행동 버튼이 있다.
2.  '던전 증축' 버튼을 클릭하면, 플레이어는 턴과 자원을 소모하여 방어에 배치할 수 있는 **최대 파티 슬롯 수**를 영구적으로 늘릴 수 있다. (`FR12`)
3.  증축에 필요한 자원의 양은 현재 파티 슬롯 수에 비례하여 점차 증가한다.
4.  증축이 완료되면, 플레이어는 늘어난 파티 슬롯에 맞춰 새로운 방어 파티를 편성하고 배치할 수 있다.
5.  특정 이벤트를 통해서도 보상으로 최대 파티 슬롯 수를 확장할 수 있다.

### **스토리 2.5: 일반 이벤트 수행과 분기 선택**

**As a** 네크로맨서,
**I want** 매 턴 발생하는 다양한 이벤트에 참여하고 선택지를 고르기를,
**so that** 자원을 얻거나, 새로운 동료를 만나거나, 스토리를 진행하는 등 다채로운 경험을 할 수 있다.

**인수 조건(Acceptance Criteria):**

1.  플레이어는 매 턴(아침/점심/저녁)마다 '이벤트' 행동을 선택할 수 있다. (`FR6`)
2.  '이벤트' 행동을 선택하면, 턴이 소모되고 외부 JSON 파일에 정의된 이벤트 목록 중 현재 **수행 가능한 이벤트 리스트가 플레이어에게 제시되며, 플레이어는 그중 하나를 직접 선택하여 진행할 수 있다.** (`NFR1`)
3.  이벤트는 상황을 묘사하는 텍스트와 플레이어가 선택할 수 있는 2~4개의 선택지로 구성된다.
4.  각 선택지는 정해진 확률에 따라 다른 결과(예: 자원 획득/손실, 동료 획득, 전투 발생 등)로 이어진다. (`FR14`)
5.  특정 주요 이벤트를 완료하거나 특정 선택지를 고르면, 멀티 엔딩 분기에 영향을 주는 '엔딩 플래그'가 활성화/비활성화될 수 있다. (`FR13`)
6.  이벤트를 통해서도 새로운 동료를 획득할 수 있다. (`FR15`)
7.  각 이벤트는 외부 JSON 파일에 정의된 '소모 일수' 값을 가진다. 이벤트가 성공적으로 종료되면, 이 '소모 일수'만큼 게임 내 시간이 경과한다.

---

## **에픽 3: 성장 및 리플레이 가치 강화**

**에픽 목표:** '스킬 카드'를 통한 동료 성장, 패배 후 '능력 계승'이 가능한 로그라이크 루프, 그리고 '멀티 엔딩' 시스템을 구현하여 장기적인 플레이 동기와 반복 플레이의 재미를 완성합니다.

### **스토리 3.1: 희귀 스킬 카드 '초월'을 통한 동료 성장**

**As a** 네크로맨서,
**I want** 동료에게 '스킬 카드'를 사용하여 새로운 스킬을 가르치거나, 이미 배운 스킬은 동일한 카드로 '초월'시키기를,
**so that** 내 주력 동료들을 더욱 강력하고 특화된 유닛으로 성장시킬 수 있다.

**인수 조건(Acceptance Criteria):**

1.  '탐험' 행동을 통해 일정 확률로 '스킬 카드' 아이템을 획득할 수 있다. (`FR16`)
2.  포로를 제물로 바치는 특수 행동을 통해 확정적으로 '스킬 카드'를 얻을 수 있다. (`FR16`)
3.  플레이어는 '동료 관리' UI에서 보유한 스킬 카드를 특정 동료에게 사용할 수 있다.
4.  동료가 해당 스킬을 배우지 않은 경우 새로운 스킬로 습득하며, **만약 동료가 이미 동일한 스킬을 보유하고 있을 경우 카드를 소모하여 해당 스킬을 '초월'시키고 성능(예: 피해량, 효과 확률)을 영구적으로 강화할 수 있다.**
5.  각 동료는 배울 수 있는 스킬의 최대 개수에 제한이 있다.
6.  스킬 카드는 '일반(Common)', '희귀(Rare)', '전설(Legendary)' 등과 같은 **희귀도** 등급을 가진다.
7.  스킬 카드의 희귀도는 획득 확률에 영향을 미친다.
8.  스킬을 '초월'시키는 데 필요한 동일 카드의 개수는 스킬의 희귀도에 따라 증가할 수 있다.

### **스토리 3.2: 로그라이크 능력 및 동료 계승**

**As a** 패배했지만 다시 도전하는 네크로맨서,
**I want** 이전 플레이에서 얻은 일부 능력과 **가장 아끼는 동료를 계승하여** 새로운 게임을 시작하기를,
**so that** 실패가 완전한 끝이 아니며, 다음 도전을 더 강력하게 시작할 수 있다는 동기부여를 얻을 수 있다.

**인수 조건(Acceptance Criteria):**

1.  게임 오버(패배) 시, '결과' 화면이 표시된다.
2.  결과 화면에는 이번 플레이의 성과(생존 일수, 격퇴한 적 수 등)가 요약되어 표시된다.
3.  플레이어는 성과에 따라 '계승 포인트'와 같은 특수 재화를 획득한다.
4.  새로운 게임을 시작하기 전, '계승' 화면에서 획득한 포인트로 영구적인 업그레이드를 구매할 수 있다.
5.  '계승' 화면에는 **'동료 보관함'**이 존재하며, 플레이어는 일정량의 '계승 포인트'를 소모하여 이전 회차의 동료 중 한 명을 보관함으로 옮길 수 있다.
6.  새로운 게임을 시작할 때, '동료 보관함'에 있는 동료를 초기 파티에 포함시켜 함께 시작할 수 있다.
7.  '계승 포인트'를 추가로 소모하여 '동료 보관함'의 슬롯 수를 늘릴 수 있다.
8.  '계승' 화면에서 구매한 업그레이드, 해금한 정보, 그리고 **보관함에 저장된 동료는** 다음 모든 플레이에 영구적으로 적용된다. (`FR5`)

### **스토리 3.3: 멀티 엔딩 시스템**

**As a** 중요한 선택의 기로에 선 네크로맨서,
**I want** 나의 결정들이 게임의 최종 결말에 영향을 미치기를,
**so that** 내 선택의 무게를 느끼고, 다른 결말을 보기 위해 다시 플레이할 동기를 얻을 수 있다.

**인수 조건(Acceptance Criteria):**

1.  게임에는 여러 개의 다른 결말(예: 선한 네크로맨서 엔딩, 세계 정복 엔딩, 파멸 엔딩 등)이 존재한다.
2.  특정 주요 이벤트를 완료하거나 특정 선택지를 고르면, 엔딩 분기에 영향을 주는 '엔딩 플래그'가 활성화/비활성화된다. (`FR13`)
3.  최종 전투(던전 위험도 100% 도달 시 발생)에서 승리했을 때, 활성화된 '엔딩 플래그'의 조합에 따라 최종 엔딩이 결정된다.
4.  각 엔딩은 고유한 텍스트와 이미지로 구성된 에필로그를 통해 플레이어에게 전달된다.
