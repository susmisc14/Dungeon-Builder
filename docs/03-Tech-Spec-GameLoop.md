# 게임 루프 기술 사양

## 개요

- 하루는 아침/점심/저녁 3턴으로 구성. 턴 진행에 따라 던전 위험도 변동 및 이벤트 발생.
- 최종적으로 던전 위험도 100% 도달 시 최종 전투 발생.

## 퍼널 전환(use-funnel) 적용

- 결정: use-funnel 유지. 게임 플레이 퍼널(인트로→선택→결과 등) 내부 단계 전환에 한정 적용
- 범위: `apps/web/app/playground/**` 내 클라이언트 컴포넌트에서 사용. 라우팅이 필요한 전역 화면 전환은 App Router 유지
- 데이터 경계: 데이터 로드는 RSC/Server Actions에서 수행하고, use-funnel은 순수 UI 단계 상태만 관리
- 접근성: 단계 전환 시 포커스 이동 및 키보드 내비게이션 보장(첫 인터랙티브 요소 포커스)
- 상태 보존: 새로고침 시 단계 상태 초기화(의도). 선택적 로컬 스토리지 동기화 허용
- 테스트: 현재 E2E 제외. 단위/통합 테스트로 퍼널 전환 핵심 흐름 검증

참고: 문서 `https://use-funnel.slash.page/ko/docs/use-funnel`

## 상태 및 데이터 흐름

- 서버 상태는 Server Actions + 캐시 태그로 제어, 클라이언트는 UI 단기 상태만 보관(Zustand)
- 각 턴 종료 또는 하루 경계에서 진행상황 자동 저장(Server Action)

## 핵심 액션(초안)

- `startGame`: 세션/프로필 초기화, 기본 자원/위험도 세팅
- `takeTurn`: 턴 경과 처리(자원/위험도/이벤트 트리거/침략 확률 계산)
- `recruit`: 동료 모집(신체 특징 조합 → 능력/스킬 산출)
- `craft`: 자원 소비하여 언데드 제작
- `saveProgress`: 하루 종료 시 진행 저장
